import{r}from"./index-Bi6L2ga8.js";const M={debug:(c,o)=>{},info:(c,o)=>{},warn:(c,o)=>{o===void 0?console.warn(`[WARN] ${c}`):console.warn(`[WARN] ${c}`,o)},error:(c,o)=>{o===void 0?console.error(`[ERROR] ${c}`):console.error(`[ERROR] ${c}`,o)}};function F(c,o,f="gtag"){if(typeof window>"u")return;const s=window,g=f==="google_analytics"?"gtag":f;try{switch(g){case"gtag":s.gtag&&s.gtag("event",c,o);break;case"segment":s.analytics&&s.analytics.track(c,o);break;case"mixpanel":s.mixpanel&&s.mixpanel.track(c,o);break;case"custom":break}M.debug(`[Analytics:${g}] ${c}`,o)}catch(w){M.warn(`[Analytics:${g}] Tracking failed:`,w)}}const Y=({enabled:c=!0,trackClicks:o=!0,trackScroll:f=!0,trackAttention:s=!0,sampleRate:g=1,onDataCollected:w,autoSend:H=!0,sendInterval:O=3e4,analyticsProvider:L,customEndpoint:b,dispatcher:k,collectAction:R,excludeSelectors:I=[],includeSelectors:x=[],anonymize:_=!1,respectDNT:U=!0})=>{const[P,j]=r.useState({clicks:[],scrollDepth:{maxDepth:0,timeToDepth:{},totalScrollTime:0},attention:[]}),y=r.useRef(P),T=t=>{j(n=>{const e=typeof t=="function"?t(n):t;return y.current=e,e})},A=r.useRef(0),$=r.useRef(0),C=r.useRef(new Set),h=r.useRef(new Map),v=r.useRef(null),[u]=r.useState(()=>c&&(!U||!navigator.doNotTrack||navigator.doNotTrack!=="1")&&Math.random()<g);r.useEffect(()=>{const t=Date.now();A.current=t,$.current=t},[]);const p=r.useCallback(t=>t?x.length>0?x.some(n=>t.matches(n)):I.some(n=>t.matches(n))?!1:["A","BUTTON","INPUT","SELECT","TEXTAREA","VIDEO","AUDIO"].includes(t.tagName)||t.hasAttribute("onclick")||t.getAttribute("role")==="button":!1,[x,I]),D=r.useCallback(t=>{if(_)return t.tagName.toLowerCase();const n=t.id?`#${t.id}`:"",e=t.className?`.${t.className.split(" ").join(".")}`:"",l=t.textContent?.slice(0,50).trim()||"";return`${t.tagName.toLowerCase()}${n}${e}${l?` "${l}"`:""}`},[_]);r.useEffect(()=>{if(!u||!o)return;const t=n=>{const e=n.target;if(!p(e))return;const l={x:n.clientX,y:n.clientY,element:D(e),timestamp:Date.now(),page:window.location.pathname};if(T(a=>({...a,clicks:[...a.clicks,l]})),s){const a=h.current.get(e);a?a.interactions++:h.current.set(e,{startTime:Date.now(),totalTime:0,interactions:1})}};return document.addEventListener("click",t,!0),()=>document.removeEventListener("click",t,!0)},[u,o,s,D,p]),r.useEffect(()=>{if(!u||!f)return;const n=W(()=>{const e=Date.now(),l=window.pageYOffset||document.documentElement.scrollTop,a=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight),m=window.innerHeight,d=a-m,N=d>0?Math.round(l/d*100):0;for(let i=10;i<=100;i+=10)N>=i&&!C.current.has(i)&&(C.current.add(i),T(S=>({...S,scrollDepth:{...S.scrollDepth,timeToDepth:{...S.scrollDepth.timeToDepth,[i]:e-A.current}}})));N>y.current.scrollDepth.maxDepth&&T(i=>({...i,scrollDepth:{...i.scrollDepth,maxDepth:N}})),T(i=>({...i,scrollDepth:{...i.scrollDepth,totalScrollTime:i.scrollDepth.totalScrollTime+(e-$.current)}})),$.current=e},100);return window.addEventListener("scroll",n),()=>window.removeEventListener("scroll",n)},[u,f]),r.useEffect(()=>{if(!u||!s)return;v.current=new IntersectionObserver(e=>{e.forEach(l=>{const a=l.target,m=Date.now();if(l.isIntersecting)h.current.has(a)||h.current.set(a,{startTime:m,totalTime:0,interactions:0});else{const d=h.current.get(a);d&&(d.totalTime+=m-d.startTime)}})},{threshold:.5,rootMargin:"0px"});const t=()=>{document.querySelectorAll("*").forEach(e=>{p(e)&&v.current?.observe(e)})};t();const n=new MutationObserver(t);return n.observe(document.body,{childList:!0,subtree:!0}),()=>{v.current?.disconnect(),n.disconnect()}},[u,s,p]);const E=r.useCallback(()=>{const t=[];h.current.forEach((e,l)=>{const a=Date.now(),m=e.totalTime+(a-e.startTime);t.push({element:D(l),timeSpent:m,visibleTime:m,interactions:e.interactions})});const n={...y.current,attention:t};return w&&w(n),L==="google_analytics"?F("heatmap_data",{custom_map:{clicks:n.clicks.length,max_scroll_depth:n.scrollDepth.maxDepth,attention_elements:n.attention.length}},"gtag"):b&&fetch(b,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).catch(e=>console.warn("Failed to send heatmap data:",e)),k&&R&&k.dispatch(R).catch(e=>console.warn("Failed to dispatch collect action:",e)),n},[D,w,L,b,k,R]);return r.useEffect(()=>{if(!u||!H)return;const t=setInterval(E,O);return()=>clearInterval(t)},[u,H,O,E]),r.useEffect(()=>{if(!u)return;const t=()=>{E()};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[u,E]),null};function W(c,o){let f;return((...s)=>{f||(c(...s),f=!0,setTimeout(()=>f=!1,o))})}export{Y as default};
