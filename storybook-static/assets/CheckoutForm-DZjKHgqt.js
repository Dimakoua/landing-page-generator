import{j as e}from"./jsx-runtime-u17CrQMm.js";import{R as y}from"./index-Bi6L2ga8.js";import{u as $}from"./useActionDispatch-DI3rZtA0.js";const R=i=>{const n=i.replace(/\s+/g,"").replace(/-/g,"");if(!/^\d{13,19}$/.test(n))return"Card number must be 13-19 digits";let a=0,r=!1;for(let o=n.length-1;o>=0;o--){let c=parseInt(n.charAt(o),10);r&&(c*=2,c>9&&(c-=9)),a+=c,r=!r}return a%10!==0?"Invalid card number":null},E=i=>{const a=i.replace(/\s+/g,"").match(/^(\d{2})\/?(\d{2})$/);if(!a)return"Expiry date must be in MM/YY format";const r=parseInt(a[1],10),o=parseInt(a[2],10)+2e3;if(r<1||r>12)return"Invalid month";const c=new Date,u=c.getFullYear(),x=c.getMonth()+1;return o<u||o===u&&r<x?"Card has expired":null},T=i=>/^\d{3,4}$/.test(i)?null:"CVV must be 3 or 4 digits",w={cardNumber:R,expiryDate:E,cvv:T},Y=i=>{const a=i.replace(/\s+/g,"").replace(/\D/g,"").match(/\d{1,4}/g);return a?a.join(" ").substr(0,19):""},B=i=>{const n=i.replace(/\D+/g,"");return n.length>=2?n.substring(0,2)+"/"+n.substring(2,4):n},L=i=>i.replace(/\D+/g,"").substring(0,4),k={cardNumber:Y,expiryDate:B,cvv:L},M=({title:i="Checkout",form:n,dispatcher:a,state:r})=>{const[o,c]=y.useState({}),[u,x]=y.useState({}),{loading:g,dispatchWithLoading:F}=$(a);y.useEffect(()=>{if(r&&r[n.id]){const t=r[n.id];console.log(`[CheckoutForm] Initializing from state[${n.id}]:`,t),c(t)}},[r,n.id]);const f=t=>{const{name:l,value:p}=t.target,m=n.fields.find(b=>b.name===l),h=m?.mask&&k[m.mask]?k[m.mask](p):p,C={...o,[l]:h};if(c(C),a){const b={type:"setState",key:n.id,value:C,merge:!0};a.dispatch(b).catch(I=>console.error("Failed to store form data:",I))}},D=t=>{if(t.preventDefault(),!a||!n.submitButton.onClick)return;const l={};let p=!1;for(const m of n.fields)if(m.validator&&w[m.validator]){const h=w[m.validator](o[m.name]||"");h&&(l[m.name]=h,p=!0)}x(l),!p&&F("submit",n.submitButton.onClick)},j=t=>/card|cvv|expiry|exp|payment|cc-number/i.test(t),S=n.fields.filter(t=>!j(t.name)),q=n.fields.filter(t=>j(t.name)),s=r&&r.cart||null,v=s&&Array.isArray(s.items)?s.items:[],N=typeof s?.subtotal=="number"?s.subtotal:typeof s?.totalPrice=="number"?s.totalPrice:v.reduce((t,l)=>t+(Number(l.price)||0)*(Number(l.quantity)||0),0),A=typeof s?.shipping=="number"?s.shipping:typeof s?.shippingCost=="number"?s.shippingCost:0,P=typeof s?.total=="number"?s.total:typeof s?.totalPrice=="number"?s.totalPrice:N+A,d={items:v,subtotal:N,shipping:A,total:P};return e.jsxs("form",{onSubmit:D,className:"w-full",children:[e.jsx("h2",{className:"sr-only",children:i}),e.jsxs("div",{className:"max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-8 mt-12",children:[e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Shipping Information"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:S.map(t=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{htmlFor:t.name,className:"text-sm font-medium text-gray-700 mb-1",children:[t.label,t.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{id:t.name,name:t.name,type:t.type,required:t.required,value:o[t.name]||"",onChange:f,placeholder:t.placeholder,className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),u[t.name]&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:u[t.name]})]},t.name))})]}),e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Payment Information"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:q.map(t=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{htmlFor:t.name,className:"text-sm font-medium text-gray-700 mb-1",children:[t.label,t.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{id:t.name,name:t.name,type:t.type,required:t.required,value:o[t.name]||"",onChange:f,placeholder:t.placeholder,className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),u[t.name]&&e.jsx("span",{className:"text-red-500 text-sm mt-1",children:u[t.name]})]},t.name))})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-md border",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Order Summary"}),d&&Array.isArray(d.items)?e.jsxs("div",{children:[d.items.map((t,l)=>e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t.image&&e.jsx("img",{src:t.image,alt:t.name,className:"w-12 h-12 rounded-md object-cover"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:t.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Qty: ",t.quantity]})]})]}),e.jsxs("div",{className:"font-medium",children:["$",(t.price*t.quantity).toFixed(2)]})]},l)),e.jsxs("div",{className:"border-t pt-3 mt-3 text-sm text-gray-700",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["$",(d.subtotal||0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{children:"Shipping"}),e.jsx("span",{children:d.shipping?`$${d.shipping.toFixed(2)}`:"Free"})]}),e.jsxs("div",{className:"flex justify-between font-semibold text-gray-900",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["$",(d.total||d.subtotal||0).toFixed(2)]})]})]})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"No cart data â€” summary will appear here."})]}),e.jsxs("div",{className:"p-6 bg-pink-600 text-white rounded-lg shadow-md",children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"Complete Your Order"}),e.jsx("p",{className:"text-sm mb-4 opacity-90",children:"Secure checkout with SSL encryption"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:g.submit,className:`flex-1 bg-white text-pink-600 py-3 rounded-md font-semibold hover:opacity-95 transition-colors ${g.submit?"opacity-50 cursor-not-allowed":""}`,children:g.submit?e.jsx("span",{className:"material-icons animate-spin",children:"refresh"}):n.submitButton.label}),e.jsx("button",{type:"button",className:"px-4 py-3 border border-white/60 rounded-md bg-transparent text-white font-medium",children:"Back to Cart"})]})]})]})]})]})};M.__docgenInfo={description:"CheckoutForm component - handles customer information and payment form",methods:[],displayName:"CheckoutForm",props:{title:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'Checkout'",computed:!1}},form:{required:!0,tsType:{name:"FormConfig"},description:""},dispatcher:{required:!1,tsType:{name:"ActionDispatcher"},description:""},actions:{required:!1,tsType:{name:"Record",elements:[{name:"string"},{name:"union",raw:`| NavigateAction
| ClosePopupAction
| RedirectAction
| ApiAction
| AnalyticsAction
| PixelAction
| IframeAction
| CustomHtmlAction
| SetStateAction
| ChainAction
| ParallelAction
| ConditionalAction
| DelayAction
| LogAction
| CartAction
| PluginAction`,elements:[{name:"NavigateAction"},{name:"ClosePopupAction"},{name:"RedirectAction"},{name:"ApiAction"},{name:"AnalyticsAction"},{name:"PixelAction"},{name:"IframeAction"},{name:"CustomHtmlAction"},{name:"SetStateAction"},{name:"ChainAction"},{name:"ParallelAction"},{name:"ConditionalAction"},{name:"DelayAction"},{name:"LogAction"},{name:"CartAction"},{name:"PluginAction"}]}],raw:"Record<string, Action>"},description:""},state:{required:!1,tsType:{name:"Record",elements:[{name:"string"},{name:"unknown"}],raw:"Record<string, unknown>"},description:""}}};export{M as default};
